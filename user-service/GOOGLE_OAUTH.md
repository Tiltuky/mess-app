## 1. Введение

Авторизация через Google использует протокол OAuth 2.0 для доступа к Google API

## 2. OAuth 2.0

В спецификации OAuth 2.0 выделяют следующие роли:

- Client. Сервис (приложение), желающий получить доступ к пользовательским данным.
- Resource Server. Сервис, владеющий пользовательскими данными.
- Authorization Server. Сервис, предоставляющий пользователю интерфейс выбора дать или нет доступ к ресурсам стороннему сервису.
- Resource Owner. Пользователь, дающий доступ к ресурсам.
  Общий флоу работы с OAuth:
- Пользователь делает запрос на предоставление Client доступа к приватным данным другого сервиса.
- Client генерирует и отправляет пользователю ссылку, которая перенаправит его на Authorization Server стороннего сервиса.
- Пользователь аутентифицируется на Authorization Server введя логин и пароль, либо ничего не вводя, т.к. в браузере уже будет активная сессия.
- Authorization Server покажет пользователю форму в которой спросит разрешается ли предоставить доступ к перечисленным ресурсам стороннему сервису.
- Если пользователь соглашается, то Authorization Server делает редирект пользователя вместе с токеном авторизации (или кодом авторизации) на эндпоинт Client.
- Client читает предоставленный токен доступа (или читает код авторизации и меняет его на токен доступа через специальный эндпоинт на Authorization Server), затем обращается с этим токеном к Resource Server.
- Resource Server проверяет токен доступа и отправляет приватные данные пользователя.
- Client получает данные, пользователь теперь может с ними взаимодействовать.

## 3. Основные шаги

1. Создать проект в Google Developer Console
1. Добавить наше приложение в проект указав необходимые scopes `userinfo.profile` и `userinfo.email`
1. Создать новые credentials с указанием `redirect_uri`, получить `client_id` и `client_sercret`
1. Реализовать эндпоинты в приложении для обработки авторизации

## 4. Техническая реализация

### 4.1 API Endpoints

- Редирект на страницу авторизации Google `GET ../login`
- Получение токена, данных пользователя, далее регистрация или авторизация в зависимости от наличия пользователя в БД `GET ../callback?code=...`

### 4.2 Библиотеки

- `golang.org/x/oauth2` - эта библиотека предоставляет базовую функциональность для работы с OAuth2.
- `google.golang.org/api/oauth2/v2` - эта библиотека является клиентской библиотекой для доступа к API Google.
